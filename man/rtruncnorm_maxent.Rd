% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/ragg.R
\name{rtruncnorm_maxent}
\alias{rtruncnorm_maxent}
\title{Maximum-Entropy Truncated Normal Random Generation}
\usage{
rtruncnorm_maxent(
  n,
  a = -Inf,
  b = Inf,
  mean = 0,
  sd = 1,
  check = TRUE,
  thr_mean = 0.1,
  thr_sd = 0.2
)
}
\arguments{
\item{n}{Integer. Number of random values to generate.}

\item{a}{Numeric scalar. Lower truncation bound (can be \code{-Inf} for no
lower truncation).}

\item{b}{Numeric scalar. Upper truncation bound (can be \code{Inf} for no
upper truncation). Must satisfy \code{a <= b}.}

\item{mean}{Numeric scalar. Target mean of the distribution on the truncated
domain \eqn{[a, b]}.}

\item{sd}{Numeric scalar. Target standard deviation of the distribution on
the truncated domain \eqn{[a, b]}. Must be strictly positive.}

\item{check}{Logical. If \code{TRUE} (default), the function validates the
generated sample using \code{.check_sample()}, comparing the empirical mean
and sd to the requested \code{mean} and \code{sd}. If the relative
deviations exceed \code{thr_mean} and/or \code{thr_sd}, an error is thrown.
If \code{FALSE}, no post-hoc validation is performed.}

\item{thr_mean}{Numeric scalar. Relative tolerance for the sample mean. A
value of \code{0.10} means that empirical means deviating by more than
10\% from the target are considered unacceptable (when \code{check = TRUE}).}

\item{thr_sd}{Numeric scalar. Relative tolerance for the sample standard
deviation. A value of \code{0.20} means that empirical standard deviations
deviating by more than 20\% from the target are considered unacceptable
(when \code{check = TRUE}).}
}
\value{
A numeric vector of length \code{n}, containing random draws from the
maximum-entropy distribution consistent with the supplied support
\code{[a, b]} and target moments \code{(mean, sd)}, \strong{provided} that those
moments are attainable by a truncated normal. If \code{check = TRUE} and the
empirical moments deviate too much from the targets, an error is raised.
}
\description{
Draws random values from the \strong{maximum-entropy} distribution on the interval
\eqn{[a, b]} subject to a fixed mean and standard deviation on the \emph{truncated}
scale.

Under the constraints:
\itemize{
\item support restricted to \eqn{[a, b]} (with \eqn{a \le b}),
\item target mean \eqn{E[X] = \code{mean}},
\item target standard deviation \eqn{\mathrm{sd}(X) = \code{sd}},
}

the maximum-entropy distribution is a Normal law, possibly truncated:
\itemize{
\item if \code{a = -Inf} and \code{b = Inf}, the solution is the ordinary
Normal \eqn{X \sim \mathcal{N}(\code{mean}, \code{sd}^2)};
\item otherwise, the solution is a \strong{truncated normal}, defined by some parent
Normal \eqn{Y \sim \mathcal{N}(\mu, \sigma^2)} truncated to \eqn{[a, b]},
where \eqn{(\mu, \sigma)} are chosen such that the truncated distribution
has mean \code{mean} and sd \code{sd}.
}

This function:
\enumerate{
\item uses \code{\link{tnorm_ab_params_from_moments}} to solve for the
underlying Gaussian parameters \eqn{(\mu, \sigma)} compatible with
\code{mean}, \code{sd}, \code{a}, and \code{b};
\item generates random values using \code{truncnorm::rtruncnorm()} on \eqn{[a, b]}
with mean \eqn{\mu} and sd \eqn{\sigma};
\item optionally checks the \strong{empirical} mean and sd of the sample against the
requested \code{mean} and \code{sd} via \code{.check_sample()}, and throws
an error if the deviations exceed user-specified thresholds.
}

In particular, when the requested pair \code{(mean, sd)} is \strong{not feasible}
for any truncated normal on \eqn{[a, b]} (for example, demanding a very large
sd near a boundary), the parameter solver may not be able to match the target
moments. With \code{check = TRUE} (the default), such cases are detected by
comparing the empirical moments of the generated sample to the targets, and
a descriptive error is raised.
}
\details{
When \code{a = -Inf} and \code{b = Inf}, no truncation is applied and the
function simply calls \code{stats::rnorm(n, mean, sd)}.

For truncated cases (\code{a > -Inf} or \code{b < Inf}), the internal solver
\code{\link{tnorm_ab_params_from_moments}} solves the nonlinear
moment-matching problem
\deqn{
  X = Y \mid a \le Y \le b, \quad Y \sim \mathcal{N}(\mu,\sigma^2)
}
such that \eqn{E[X] = \code{mean}} and \eqn{\mathrm{sd}(X) = \code{sd}}.
Not all combinations of \code{(mean, sd, a, b)} are feasible for a truncated
normal distribution (for instance, the mean must lie in \code{[a, b]} when
both bounds are finite, and the sd cannot exceed the maximum possible sd on
the interval). In such infeasible cases, either the parameter solver will
error directly, or, if parameters are found but the resulting sample moments
are too far from the targets, \code{rtruncnorm_maxent()} will error when
\code{check = TRUE}.

The post-hoc validation uses \code{.check_sample()} on a single-column matrix
of draws. Internally, the sample is considered acceptable if the relative
deviation of the sample mean is at most \code{thr_mean} and the relative
deviation of the sample sd is at most \code{thr_sd}. Otherwise a descriptive
error is thrown indicating that the target moments cannot be achieved by a
truncated normal on the specified interval.
}
\examples{
\dontrun{
  set.seed(1)

  ## 1) Untruncated Normal: mean = 5, sd = 2
  x1 <- rtruncnorm_maxent(1e4, a = -Inf, b = Inf, mean = 5, sd = 2)
  mean(x1); sd(x1)

  ## 2) Lower-truncated at 0: mean = 1, sd = 0.7
  x2 <- rtruncnorm_maxent(1e4, a = 0, b = Inf, mean = 1, sd = 0.7)
  range(x2); mean(x2); sd(x2)

  ## 3) Two-sided truncation [0, 3]: mean = 1.4, sd = 0.6
  x3 <- rtruncnorm_maxent(1e4, a = 0, b = 3, mean = 1.4, sd = 0.6)
  range(x3); mean(x3); sd(x3)

  ## 4) Infeasible target: will error (mean too high relative to sd and bounds)
  x4 <- rtruncnorm_maxent(1e4, a = 0, b = 15, mean = 10, sd = 5)
}
}
\seealso{
\code{\link{tnorm_ab_params_from_moments}} for the underlying parameter
solver; \code{truncnorm::rtruncnorm()} for the truncated normal RNG;
\code{\link{ragg}} for a higher-level random-number generator that chooses
distributions based on argument combinations; and \code{.check_sample()} for
the sample-based validation routine.
}
